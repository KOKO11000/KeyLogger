<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Admin – Live</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body{background:#0b1220;color:#e9f1ff;font-family:Segoe UI,Arial,sans-serif;margin:0;padding:1rem}
    h1{margin:0 0 1rem 0}
    .wrap{display:grid; grid-template-columns:1fr 1fr; gap:1rem}
    .card{border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:1rem; background:#0f1a2b}
    .row{margin:.25rem 0}
    .user{color:#00e5ff; font-weight:700}
    .word{background:linear-gradient(135deg,#00e5ff,#009dff); color:#001018; font-weight:700; padding:.15rem .5rem; border-radius:999px; margin-inline:.3rem}
    .time{color:#98a6bd; font-size:.85rem; margin-inline:.3rem}
    pre{white-space:pre-wrap}
    ul{margin:0; padding-left:1rem}
  </style>
</head>
<body>
  <h1>צפייה חיה + הסכמות</h1>
  <div class="wrap">
    <div class="card">
      <h3>שידור חי</h3>
      <div id="feed"></div>
    </div>
    <div class="card">
      <h3>הסכמות היום</h3>
      <button id="refreshConsents">רענן</button>
      <ul id="consentsList"></ul>
    </div>
  </div>
  
  <div class="card">
    <h3>משתמשים מחוברים</h3>
    <ul id="usersList"><li>(אין מחוברים)</li></ul>
  </div>

  <script>
    const usersList = document.getElementById("usersList");

    socket.on("usersOnline", (users) => {
      usersList.innerHTML = "";
      if (!users.length) {
        usersList.innerHTML = "<li>(אין מחוברים)</li>";
        return;
      }
      users.forEach(u => {
        const li = document.createElement("li");
        li.innerHTML = `<span style="color:lime">●</span> ${u}`;
        usersList.appendChild(li);
      });
    });
  </script>



  <script>
    // מילים חיות
    const feed = document.getElementById("feed");
    const socket = io();
    socket.on("word", ({userId, word, ts, newline}) => {
      const div = document.createElement("div");
      div.className="row";
      const time = new Date(ts).toLocaleTimeString();
      div.innerHTML = `<span class="time">${time}</span>
                       <span class="user">[${userId}]</span>
                       <span class="word">${word}</span>
                       ${newline ? "<em>(↵)</em>" : ""}`;
      feed.appendChild(div);
      feed.scrollTop = feed.scrollHeight;
    });

    // הסכמות
    const consentsList = document.getElementById("consentsList");
    document.getElementById("refreshConsents").onclick = async () => {
      consentsList.innerHTML = "<li>טוען...</li>";
      const r = await fetch("/consents");
      const arr = await r.json();
      consentsList.innerHTML = "";
      if (!arr.length) { consentsList.innerHTML = "<li>(אין)</li>"; return; }
      arr.forEach(c => {
        const li = document.createElement("li");
        const t = new Date(c.ts).toLocaleString();
        li.textContent = `${t} — ${c.userId} — ${c.ip}`;
        consentsList.appendChild(li);
      });
    };
      

  </script>
</body>
</html>
